!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("lib",[],e):"object"==typeof exports?exports.lib=e():t.lib=e()}("undefined"!=typeof self?self:this,function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=3)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class n extends TypeError{constructor(t,e){super(e),this.code=t,this.name="ByContractError",this.message=e,Object.setPrototypeOf(this,n.prototype)}toString(){return"ByContractError: "+this.message}}e.default=n},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n={arguments:t=>"[object Arguments]"===toString.call(t),array:Array.isArray||function(t){return"[object Array]"===toString.call(t)},string:t=>"[object String]"===toString.call(t),undefined:t=>void 0===t,boolean:t=>!0===t||!1===t||"[object Boolean]"===toString.call(t),function:t=>"[object Function]"===toString.call(t)||"function"==typeof t,nan:t=>t!=t,null:t=>null===t,number:t=>!n.nan(t)&&"[object Number]"===toString.call(t),regexp:t=>"[object RegExp]"===toString.call(t),object:t=>{const e=typeof t;return"function"===e||"object"===e&&!!t}};e.default=n},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=n(r(4)),o=r(6);e.Exception=i.default.Exception,e.default=i.default,e.contract=function(t){return function(r,n,a){const s=a.value,{params:c,returns:u}=o.validateJsDocString(t);return i.default.isEnabled?Object.assign({},a,{value:function(){const t=Array.from(arguments);c.forEach((r,o)=>{try{i.default(t[o],r.contract)}catch(t){throw new e.Exception(t.code,`Method: ${n}, parameter ${r.name}: `+t.message)}});let r=s.apply(this,t);try{u&&i.default(r,u.contract)}catch(t){throw new e.Exception(t.code,`Method: ${n}, return value: `+t.message)}return r}}):a}}},function(t,e,r){"use strict";(function(t){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=n(r(0)),o=n(r(5)),a=n(r(2)),s="undefined"!=typeof window?window:t,c={};function u(t,e,r){return`${e?e+": ":""}${void 0!==r?`Argument #${r}: `:""}${t}`}function l(t,e,r){if(!l.isEnabled)return t;if(void 0===e)throw new i.default("EINVALIDPARAM",u("Invalid parameters. The second parameter (contracts) is missing",r));if(a.default.array(e)){if(a.default.arguments(t)&&(t=Array.from(t)),!a.default.array(t))throw new i.default("EINVALIDPARAM",u("Invalid parameters. When the second parameter (contracts) is an array, the first parameter (values) must an array too",r));return e.forEach((e,n)=>{if(!(n in t))throw new i.default("EMISSINGARG",u("Missing required agument",r));l.validate(t[n],e,r,n)}),t}return l.validate(t,e,r),t}e.default=l,l.validate=((t,e,r,n)=>{try{if(e in c)return o.default(t,c[e]);o.default(t,e)}catch(t){if(!(t instanceof i.default))throw t;throw new i.default(t.code,u(t.message,r,n))}}),l.Exception=i.default,l.isEnabled=!0,l.typedef=function(t,e){if(l([t,e],["string","*"],"byContract.typedef"),t in a.default)throw new i.default("EINVALIDPARAM","Custom type must not override a primitive");c[t]=e},s.byContract=l}).call(this,r(1))},function(t,e,r){"use strict";(function(t){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=n(r(0)),o=n(r(2)),a="undefined"!=typeof window?window:t;function s(t){return"object"==typeof t&&"constructor"in t&&t.constructor.name?`instance of ${t.constructor.name}`:"function"==typeof t?t.prototype.constructor.name:c(t)}function c(t){return Object.keys(o.default).find(e=>o.default[e](t))||typeof t}function u(t,e,r=""){new f(t,e,r).validate()}function l(t,e){return e?e+"."+t:t}e.default=u;class f{constructor(t,e,r=""){this.val=t,this.contract=e,this.propPath=r}validate(){if(!this.assertAny()&&!this.assertObject()&&!this.assertInterface()){if(!o.default.string(this.contract))throw this.newException("EINVALIDCONTRACT","Invalid parameters. Contract must be a string or a constructor function");if(!(this.assertOptional()||this.assertBasicType()||this.assertNullable()||this.assertNonNullable())){if(this.assertUnion())return!0;if(!this.assertStrictArray()&&!this.assertStrictObject()){if(!this.contract.match(/^[a-zA-Z0-9\._]+$/))throw this.newException("EINVALIDCONTRACT",`Invalid contract ${JSON.stringify(this.contract)}`);if(!this.assertGlobal())throw this.newException("EINVALIDCONTRACT",`Invalid contract ${JSON.stringify(this.contract)}`)}}}}assertGlobal(){if(!(this.contract in a)||"function"!=typeof a[this.contract])return!1;if(this.val instanceof a[this.contract])return!0;throw this.newException("EINTERFACEVIOLATION",`Expected instance of ${a[this.contract]} but got ${s(this.val)}`)}assertAny(){return!(!o.default.string(this.contract)||"*"!==this.contract)}assertObject(){if(!this.contract||"object"!=typeof this.contract)return!1;if(!this.val||"object"!=typeof this.val)throw this.newException("EINVALIDTYPE",`Expected object literal but got ${c(this.val)}`);return Object.keys(this.contract).forEach((t,e)=>{const r=this.contract[t];if(!(t in this.val||function(t){return o.default.string(t)&&t.endsWith("=")}(r)))throw this.newException("EMISSINGPROP","Missing required property #"+l(t,this.propPath));u(this.val[t],r,l(t,this.propPath))}),!0}assertInterface(){if(!o.default.function(this.contract)&&"object"!=typeof this.contract)return!1;if(!(this.val instanceof this.contract))throw this.newException("EINTERFACEVIOLATION",`Expected instance of ${s(this.contract)} but got ${s(this.val)}`);return!0}assertOptional(){if(this.contract.match(/=$/)){if(!this.val)return!0;this.contract=this.contract.substr(0,this.contract.length-1)}return!1}assertBasicType(){const t=this.contract.toLowerCase(),e=o.default[t];if(void 0===e)return!1;if(!e(this.val))throw this.newException("EINVALIDTYPE",`Expected ${t} but got ${c(this.val)}`);return!0}assertNullable(){if("?number"!==this.contract)return!1;if(o.default.number(this.val)||o.default.null(this.val))return!0;throw this.newException("EINVALIDTYPE",`Expected nullable but got ${c(this.val)}`)}assertNonNullable(){if("!number"!==this.contract)return!1;if(o.default.number(this.val)&&!o.default.null(this.val))return!0;throw this.newException("EINVALIDTYPE",`Expected non-nullable but got ${c(this.val)}`)}assertUnion(){if(!this.contract.includes("|"))return!1;if(!this.contract.split("|").some(t=>(function(t,e){try{return u(t,e),!0}catch(t){if(!(t instanceof i.default))throw t;return!1}})(this.val,t)))throw this.newException("EINVALIDTYPE",`Expected ${this.contract} but got ${c(this.val)}`);return!0}assertStrictArray(){if(!this.contract.startsWith("Array.<"))return!1;let t=0;const e=this.contract.match(/Array\.<(.+)>/i);if(!e)throw this.newException("EINVALIDCONTRACT",`Invalid contract ${s(this.contract)}`);try{o.default.array(this.val)&&this.val.forEach(r=>{u(r,e[1]),t++})}catch(e){throw this.newException("EINVALIDTYPE",`array element ${t}: ${e.message}`)}return!0}assertStrictObject(){if(0!==this.contract.indexOf("Object.<"))return!1;let t=null;const e=this.contract.match(/Object\.<(.+),\s*(.+)>/i);if(!e)throw this.newException("EINVALIDCONTRACT",`Invalid contract ${s(this.contract)}`);try{o.default.object(this.val)&&Object.keys(this.val).forEach(r=>{t=r,u(this.val[r],e[2])})}catch(e){throw this.newException("EINVALIDTYPE",`object property ${t}: ${e.message}`)}return!0}newException(t,e){const r=this.propPath?` property #${this.propPath} `:"";return new i.default(t,r+e)}}}).call(this,r(1))},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=n(r(0));function o(t){const e=t.indexOf("{"),r=t.indexOf("}");if(-1===e||-1===r)throw new i.default("EINVALIDJSDOC","Invalid JSDOC");return{contract:t.substr(e+1,r-e-1),name:t.substr(r+1).trim()}}e.validateJsDocString=function(t){let e=[],r=null;return t.split("\n").map(t=>t.trim()).filter(t=>t.length).forEach(t=>{switch(!0){case t.startsWith("@param"):e.push(o(t));break;case t.startsWith("@returns"):r=o(t);break;default:throw new i.default("EINVALIDJSDOC","Only @param and @returns tags allowed")}}),{params:e,returns:r}}}])});